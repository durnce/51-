C51 COMPILER V9.59.0.0   MAIN                                                              10/16/2023 13:31:38 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\Keil_C51\C51\BIN\C51.EXE main.c LARGE OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listin
                    -gs\main.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <STC89C5xRC.H>
   2          #include <intrins.h>
   3          #include "dht22.h"
   4          #include "oled.h"
   5          #include <stdio.h>
   6          
   7          #include "picture.h"  
   8          
   9          
  10          #define uint unsigned int 
  11          #define uchar unsigned char 
  12          /*************************************************************************************************
  13          *                                     PIN脚定义
  14          *************************************************************************************************/
  15          //水位检测
  16          sbit Water_level = P1^0;                  
  17          sbit buzzzer = P2^4;
  18          sbit led2 =P1^7;        
  19          
  20          //喷雾检测
  21          sbit led = P1^6;
  22          sbit pwm1 =P1^1;      //1档
  23          sbit pwm2 =P1^5;      //2档
  24          
  25          
  26          //独立按键                                  
  27          sbit Key_L = P1^2;                        
  28          sbit Key_H = P1^3;
  29          sbit key_ctrl =P1^4;      //挡位控制
  30          /*************************************************************************************************
  31          *                                     全局变量
  32          *************************************************************************************************/
  33          struct countkey                       //按键扫描结构体
  34          {
  35            volatile unsigned int debounce_count;       //中断计数器0
  36            volatile unsigned int debounce_count2;      //中断计数器2
  37            volatile unsigned int debounce_count3;
  38            int warring;                    //预警湿度
  39          } key={0,0,0,90};                   //中断计数器0,中断计数器2,检测    
  40          
  41          struct Gear                         //喷雾工作结构体
  42          {
  43            unsigned char flag;       //    判断工作
  44            volatile unsigned char count;     //挡位
  45          } atomizing={0,2};
  46          
  47          struct oled_show                          //oled显示中间变量                        
  48          {
  49            unsigned char humidity2[5];               
  50            unsigned char temperature2[5];
  51            int warring2[3];
  52            int count2[2];
  53          }Invert;
  54          /*************************************************************************************************
C51 COMPILER V9.59.0.0   MAIN                                                              10/16/2023 13:31:38 PAGE 2   

  55          *                                     oled字模库
  56          *************************************************************************************************/
  57          unsigned char code F16x16[] =//中文字模    
  58          { 
  59            
  60          0x20,0x20,0x20,0x20,0x20,0x20,0x21,0x22,0x2C,0x20,0x20,0x20,0x20,0x20,0x20,0x00,
  61          0x00,0x40,0x20,0x10,0x0C,0x03,0x00,0x00,0x00,0x01,0x02,0x04,0x18,0x60,0x00,0x00,/*"六",0*/
  62          
  63          0x02,0x02,0xFE,0x92,0x92,0xFE,0x02,0x02,0xFC,0x04,0x04,0x04,0x04,0xFC,0x00,0x00,
  64          0x08,0x18,0x0F,0x08,0x04,0xFF,0x04,0x80,0x63,0x19,0x01,0x01,0x09,0x33,0xC0,0x00,/*"职",1*/
  65          
  66          0x00,0x00,0x00,0xFC,0x44,0x44,0x44,0x45,0x46,0x44,0x44,0x44,0x44,0x7C,0x00,0x00,
  67          0x40,0x20,0x18,0x07,0x00,0xFC,0x44,0x44,0x44,0x44,0x44,0x44,0x44,0xFC,0x00,0x00,/*"启",2*/
  68          
  69          0x40,0x50,0x4E,0x48,0x48,0xFF,0x48,0x48,0x48,0x40,0xF8,0x00,0x00,0xFF,0x00,0x00,
  70          0x00,0x00,0x3E,0x02,0x02,0xFF,0x12,0x22,0x1E,0x00,0x0F,0x40,0x80,0x7F,0x00,0x00,/*"制",3*/
  71          
  72          0x00,0xFE,0x02,0x22,0xDA,0x06,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,
  73          0x00,0xFF,0x08,0x10,0x88,0x47,0x20,0x18,0x07,0x00,0x07,0x18,0x20,0x40,0x80,0x00,/*"队",4*/
  74          
  75          0x10,0x60,0x02,0x8C,0x00,0x00,0xFE,0x92,0x92,0x92,0x92,0x92,0xFE,0x00,0x00,0x00,
  76          0x04,0x04,0x7E,0x01,0x40,0x7E,0x42,0x42,0x7E,0x42,0x7E,0x42,0x42,0x7E,0x40,0x00,/*"温",5*/
  77          
  78          0x10,0x60,0x02,0x8C,0x00,0xFE,0x92,0x92,0x92,0x92,0x92,0x92,0xFE,0x00,0x00,0x00,
  79          0x04,0x04,0x7E,0x01,0x44,0x48,0x50,0x7F,0x40,0x40,0x7F,0x50,0x48,0x44,0x40,0x00,/*"湿",6*/
  80          
  81          0x00,0x00,0xFC,0x24,0x24,0x24,0xFC,0x25,0x26,0x24,0xFC,0x24,0x24,0x24,0x04,0x00,
  82          0x40,0x30,0x8F,0x80,0x84,0x4C,0x55,0x25,0x25,0x25,0x55,0x4C,0x80,0x80,0x80,0x00,/*"度",7*/
  83          
  84          0x42,0x4A,0xD2,0x6A,0x46,0xC0,0x00,0xF2,0x12,0x1A,0xD6,0x12,0x12,0xF2,0x02,0x00,
  85          0x40,0x80,0x7F,0x00,0x01,0x00,0x80,0x4F,0x20,0x18,0x07,0x10,0x20,0x4F,0x80,0x00,/*"预",8*/
  86          
  87          0x40,0x40,0x42,0xCC,0x00,0x40,0xA0,0x9E,0x82,0x82,0x82,0x9E,0xA0,0x20,0x20,0x00,
  88          0x00,0x00,0x00,0x3F,0x90,0x88,0x40,0x43,0x2C,0x10,0x28,0x46,0x41,0x80,0x80,0x00,/*"设",9*/
  89          
  90          
  91          
  92          0x10,0x10,0x10,0xFF,0x10,0x50,0x42,0x5C,0x40,0x7F,0x40,0x40,0x50,0xCE,0x00,0x00,
  93          0x04,0x44,0x82,0x7F,0x01,0x40,0x44,0x44,0x44,0x44,0x44,0x44,0x44,0xFF,0x00,0x00,/*"挡",10*/
  94          
  95          0x00,0x80,0x60,0xF8,0x07,0x10,0x90,0x10,0x11,0x16,0x10,0x10,0xD0,0x10,0x00,0x00,
  96          0x01,0x00,0x00,0xFF,0x40,0x40,0x41,0x5E,0x40,0x40,0x70,0x4E,0x41,0x40,0x40,0x00,/*"位",11*/
  97          };
  98          const unsigned char code F8X16[]= //字符串  
  99          {
 100            0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,//  0
 101            0x00,0x00,0x00,0xF8,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x33,0x30,0x00,0x00,0x00,//! 1
 102            0x00,0x10,0x0C,0x06,0x10,0x0C,0x06,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,//" 2
 103            0x40,0xC0,0x78,0x40,0xC0,0x78,0x40,0x00,0x04,0x3F,0x04,0x04,0x3F,0x04,0x04,0x00,//# 3
 104            0x00,0x70,0x88,0xFC,0x08,0x30,0x00,0x00,0x00,0x18,0x20,0xFF,0x21,0x1E,0x00,0x00,//$ 4
 105            0xF0,0x08,0xF0,0x00,0xE0,0x18,0x00,0x00,0x00,0x21,0x1C,0x03,0x1E,0x21,0x1E,0x00,//% 5
 106            0x00,0xF0,0x08,0x88,0x70,0x00,0x00,0x00,0x1E,0x21,0x23,0x24,0x19,0x27,0x21,0x10,//& 6
 107            0x10,0x16,0x0E,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,//' 7
 108            0x00,0x00,0x00,0xE0,0x18,0x04,0x02,0x00,0x00,0x00,0x00,0x07,0x18,0x20,0x40,0x00,//( 8
 109            0x00,0x02,0x04,0x18,0xE0,0x00,0x00,0x00,0x00,0x40,0x20,0x18,0x07,0x00,0x00,0x00,//) 9
 110            0x40,0x40,0x80,0xF0,0x80,0x40,0x40,0x00,0x02,0x02,0x01,0x0F,0x01,0x02,0x02,0x00,//* 10
 111            0x00,0x00,0x00,0xF0,0x00,0x00,0x00,0x00,0x01,0x01,0x01,0x1F,0x01,0x01,0x01,0x00,//+ 11
 112            0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0xB0,0x70,0x00,0x00,0x00,0x00,0x00,//, 12
 113            0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x01,0x01,0x01,0x01,0x01,//- 13
 114            0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x30,0x30,0x00,0x00,0x00,0x00,0x00,//. 14
 115            0x00,0x00,0x00,0x00,0x80,0x60,0x18,0x04,0x00,0x60,0x18,0x06,0x01,0x00,0x00,0x00,/// 15
 116            0x00,0xE0,0x10,0x08,0x08,0x10,0xE0,0x00,0x00,0x0F,0x10,0x20,0x20,0x10,0x0F,0x00,//0 16
C51 COMPILER V9.59.0.0   MAIN                                                              10/16/2023 13:31:38 PAGE 3   

 117            0x00,0x10,0x10,0xF8,0x00,0x00,0x00,0x00,0x00,0x20,0x20,0x3F,0x20,0x20,0x00,0x00,//1 17
 118            0x00,0x70,0x08,0x08,0x08,0x88,0x70,0x00,0x00,0x30,0x28,0x24,0x22,0x21,0x30,0x00,//2 18
 119            0x00,0x30,0x08,0x88,0x88,0x48,0x30,0x00,0x00,0x18,0x20,0x20,0x20,0x11,0x0E,0x00,//3 19
 120            0x00,0x00,0xC0,0x20,0x10,0xF8,0x00,0x00,0x00,0x07,0x04,0x24,0x24,0x3F,0x24,0x00,//4 20
 121            0x00,0xF8,0x08,0x88,0x88,0x08,0x08,0x00,0x00,0x19,0x21,0x20,0x20,0x11,0x0E,0x00,//5 21
 122            0x00,0xE0,0x10,0x88,0x88,0x18,0x00,0x00,0x00,0x0F,0x11,0x20,0x20,0x11,0x0E,0x00,//6 22
 123            0x00,0x38,0x08,0x08,0xC8,0x38,0x08,0x00,0x00,0x00,0x00,0x3F,0x00,0x00,0x00,0x00,//7 23
 124            0x00,0x70,0x88,0x08,0x08,0x88,0x70,0x00,0x00,0x1C,0x22,0x21,0x21,0x22,0x1C,0x00,//8 24
 125            0x00,0xE0,0x10,0x08,0x08,0x10,0xE0,0x00,0x00,0x00,0x31,0x22,0x22,0x11,0x0F,0x00,//9 25
 126            0x00,0x00,0x00,0xC0,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x30,0x30,0x00,0x00,0x00,//: 26
 127            0x00,0x00,0x00,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x60,0x00,0x00,0x00,0x00,//; 27
 128            0x00,0x00,0x80,0x40,0x20,0x10,0x08,0x00,0x00,0x01,0x02,0x04,0x08,0x10,0x20,0x00,//< 28
 129            0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x00,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x00,//= 29
 130            0x00,0x08,0x10,0x20,0x40,0x80,0x00,0x00,0x00,0x20,0x10,0x08,0x04,0x02,0x01,0x00,//> 30
 131            0x00,0x70,0x48,0x08,0x08,0x08,0xF0,0x00,0x00,0x00,0x00,0x30,0x36,0x01,0x00,0x00,//? 31
 132            0xC0,0x30,0xC8,0x28,0xE8,0x10,0xE0,0x00,0x07,0x18,0x27,0x24,0x23,0x14,0x0B,0x00,//@ 32
 133            0x00,0x00,0xC0,0x38,0xE0,0x00,0x00,0x00,0x20,0x3C,0x23,0x02,0x02,0x27,0x38,0x20,//A 33
 134            0x08,0xF8,0x88,0x88,0x88,0x70,0x00,0x00,0x20,0x3F,0x20,0x20,0x20,0x11,0x0E,0x00,//B 34
 135            0xC0,0x30,0x08,0x08,0x08,0x08,0x38,0x00,0x07,0x18,0x20,0x20,0x20,0x10,0x08,0x00,//C 35
 136            0x08,0xF8,0x08,0x08,0x08,0x10,0xE0,0x00,0x20,0x3F,0x20,0x20,0x20,0x10,0x0F,0x00,//D 36
 137            0x08,0xF8,0x88,0x88,0xE8,0x08,0x10,0x00,0x20,0x3F,0x20,0x20,0x23,0x20,0x18,0x00,//E 37
 138            0x08,0xF8,0x88,0x88,0xE8,0x08,0x10,0x00,0x20,0x3F,0x20,0x00,0x03,0x00,0x00,0x00,//F 38
 139            0xC0,0x30,0x08,0x08,0x08,0x38,0x00,0x00,0x07,0x18,0x20,0x20,0x22,0x1E,0x02,0x00,//G 39
 140            0x08,0xF8,0x08,0x00,0x00,0x08,0xF8,0x08,0x20,0x3F,0x21,0x01,0x01,0x21,0x3F,0x20,//H 40
 141            0x00,0x08,0x08,0xF8,0x08,0x08,0x00,0x00,0x00,0x20,0x20,0x3F,0x20,0x20,0x00,0x00,//I 41
 142            0x00,0x00,0x08,0x08,0xF8,0x08,0x08,0x00,0xC0,0x80,0x80,0x80,0x7F,0x00,0x00,0x00,//J 42
 143            0x08,0xF8,0x88,0xC0,0x28,0x18,0x08,0x00,0x20,0x3F,0x20,0x01,0x26,0x38,0x20,0x00,//K 43
 144            0x08,0xF8,0x08,0x00,0x00,0x00,0x00,0x00,0x20,0x3F,0x20,0x20,0x20,0x20,0x30,0x00,//L 44
 145            0x08,0xF8,0xF8,0x00,0xF8,0xF8,0x08,0x00,0x20,0x3F,0x00,0x3F,0x00,0x3F,0x20,0x00,//M 45
 146            0x08,0xF8,0x30,0xC0,0x00,0x08,0xF8,0x08,0x20,0x3F,0x20,0x00,0x07,0x18,0x3F,0x00,//N 46
 147            0xE0,0x10,0x08,0x08,0x08,0x10,0xE0,0x00,0x0F,0x10,0x20,0x20,0x20,0x10,0x0F,0x00,//O 47
 148            0x08,0xF8,0x08,0x08,0x08,0x08,0xF0,0x00,0x20,0x3F,0x21,0x01,0x01,0x01,0x00,0x00,//P 48
 149            0xE0,0x10,0x08,0x08,0x08,0x10,0xE0,0x00,0x0F,0x18,0x24,0x24,0x38,0x50,0x4F,0x00,//Q 49
 150            0x08,0xF8,0x88,0x88,0x88,0x88,0x70,0x00,0x20,0x3F,0x20,0x00,0x03,0x0C,0x30,0x20,//R 50
 151            0x00,0x70,0x88,0x08,0x08,0x08,0x38,0x00,0x00,0x38,0x20,0x21,0x21,0x22,0x1C,0x00,//S 51
 152            0x18,0x08,0x08,0xF8,0x08,0x08,0x18,0x00,0x00,0x00,0x20,0x3F,0x20,0x00,0x00,0x00,//T 52
 153            0x08,0xF8,0x08,0x00,0x00,0x08,0xF8,0x08,0x00,0x1F,0x20,0x20,0x20,0x20,0x1F,0x00,//U 53
 154            0x08,0x78,0x88,0x00,0x00,0xC8,0x38,0x08,0x00,0x00,0x07,0x38,0x0E,0x01,0x00,0x00,//V 54
 155            0xF8,0x08,0x00,0xF8,0x00,0x08,0xF8,0x00,0x03,0x3C,0x07,0x00,0x07,0x3C,0x03,0x00,//W 55
 156            0x08,0x18,0x68,0x80,0x80,0x68,0x18,0x08,0x20,0x30,0x2C,0x03,0x03,0x2C,0x30,0x20,//X 56
 157            0x08,0x38,0xC8,0x00,0xC8,0x38,0x08,0x00,0x00,0x00,0x20,0x3F,0x20,0x00,0x00,0x00,//Y 57
 158            0x10,0x08,0x08,0x08,0xC8,0x38,0x08,0x00,0x20,0x38,0x26,0x21,0x20,0x20,0x18,0x00,//Z 58
 159            0x00,0x00,0x00,0xFE,0x02,0x02,0x02,0x00,0x00,0x00,0x00,0x7F,0x40,0x40,0x40,0x00,//[ 59
 160            0x00,0x0C,0x30,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x06,0x38,0xC0,0x00,//\ 60
 161            0x00,0x02,0x02,0x02,0xFE,0x00,0x00,0x00,0x00,0x40,0x40,0x40,0x7F,0x00,0x00,0x00,//] 61
 162            0x00,0x00,0x04,0x02,0x02,0x02,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,//^ 62
 163            0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,//_ 63
 164            0x00,0x02,0x02,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,//` 64
 165            0x00,0x00,0x80,0x80,0x80,0x80,0x00,0x00,0x00,0x19,0x24,0x22,0x22,0x22,0x3F,0x20,//a 65
 166            0x08,0xF8,0x00,0x80,0x80,0x00,0x00,0x00,0x00,0x3F,0x11,0x20,0x20,0x11,0x0E,0x00,//b 66
 167            0x00,0x00,0x00,0x80,0x80,0x80,0x00,0x00,0x00,0x0E,0x11,0x20,0x20,0x20,0x11,0x00,//c 67
 168            0x00,0x00,0x00,0x80,0x80,0x88,0xF8,0x00,0x00,0x0E,0x11,0x20,0x20,0x10,0x3F,0x20,//d 68
 169            0x00,0x00,0x80,0x80,0x80,0x80,0x00,0x00,0x00,0x1F,0x22,0x22,0x22,0x22,0x13,0x00,//e 69
 170            0x00,0x80,0x80,0xF0,0x88,0x88,0x88,0x18,0x00,0x20,0x20,0x3F,0x20,0x20,0x00,0x00,//f 70
 171            0x00,0x00,0x80,0x80,0x80,0x80,0x80,0x00,0x00,0x6B,0x94,0x94,0x94,0x93,0x60,0x00,//g 71
 172            0x08,0xF8,0x00,0x80,0x80,0x80,0x00,0x00,0x20,0x3F,0x21,0x00,0x00,0x20,0x3F,0x20,//h 72
 173            0x00,0x80,0x98,0x98,0x00,0x00,0x00,0x00,0x00,0x20,0x20,0x3F,0x20,0x20,0x00,0x00,//i 73
 174            0x00,0x00,0x00,0x80,0x98,0x98,0x00,0x00,0x00,0xC0,0x80,0x80,0x80,0x7F,0x00,0x00,//j 74
 175            0x08,0xF8,0x00,0x00,0x80,0x80,0x80,0x00,0x20,0x3F,0x24,0x02,0x2D,0x30,0x20,0x00,//k 75
 176            0x00,0x08,0x08,0xF8,0x00,0x00,0x00,0x00,0x00,0x20,0x20,0x3F,0x20,0x20,0x00,0x00,//l 76
 177            0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x00,0x20,0x3F,0x20,0x00,0x3F,0x20,0x00,0x3F,//m 77
 178            0x80,0x80,0x00,0x80,0x80,0x80,0x00,0x00,0x20,0x3F,0x21,0x00,0x00,0x20,0x3F,0x20,//n 78
C51 COMPILER V9.59.0.0   MAIN                                                              10/16/2023 13:31:38 PAGE 4   

 179            0x00,0x00,0x80,0x80,0x80,0x80,0x00,0x00,0x00,0x1F,0x20,0x20,0x20,0x20,0x1F,0x00,//o 79
 180            0x80,0x80,0x00,0x80,0x80,0x00,0x00,0x00,0x80,0xFF,0xA1,0x20,0x20,0x11,0x0E,0x00,//p 80
 181            0x00,0x00,0x00,0x80,0x80,0x80,0x80,0x00,0x00,0x0E,0x11,0x20,0x20,0xA0,0xFF,0x80,//q 81
 182            0x80,0x80,0x80,0x00,0x80,0x80,0x80,0x00,0x20,0x20,0x3F,0x21,0x20,0x00,0x01,0x00,//r 82
 183            0x00,0x00,0x80,0x80,0x80,0x80,0x80,0x00,0x00,0x33,0x24,0x24,0x24,0x24,0x19,0x00,//s 83
 184            0x00,0x80,0x80,0xE0,0x80,0x80,0x00,0x00,0x00,0x00,0x00,0x1F,0x20,0x20,0x00,0x00,//t 84
 185            0x80,0x80,0x00,0x00,0x00,0x80,0x80,0x00,0x00,0x1F,0x20,0x20,0x20,0x10,0x3F,0x20,//u 85
 186            0x80,0x80,0x80,0x00,0x00,0x80,0x80,0x80,0x00,0x01,0x0E,0x30,0x08,0x06,0x01,0x00,//v 86
 187            0x80,0x80,0x00,0x80,0x00,0x80,0x80,0x80,0x0F,0x30,0x0C,0x03,0x0C,0x30,0x0F,0x00,//w 87
 188            0x00,0x80,0x80,0x00,0x80,0x80,0x80,0x00,0x00,0x20,0x31,0x2E,0x0E,0x31,0x20,0x00,//x 88
 189            0x80,0x80,0x80,0x00,0x00,0x80,0x80,0x80,0x80,0x81,0x8E,0x70,0x18,0x06,0x01,0x00,//y 89
 190            0x00,0x80,0x80,0x80,0x80,0x80,0x80,0x00,0x00,0x21,0x30,0x2C,0x22,0x21,0x30,0x00,//z 90
 191            0x00,0x00,0x00,0x00,0x80,0x7C,0x02,0x02,0x00,0x00,0x00,0x00,0x00,0x3F,0x40,0x40,//{ 91
 192            0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,//| 92
 193            0x00,0x02,0x02,0x7C,0x80,0x00,0x00,0x00,0x00,0x40,0x40,0x3F,0x00,0x00,0x00,0x00,//} 93
 194            0x00,0x06,0x01,0x01,0x02,0x02,0x04,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,//~ 94
 195          };
 196          
 197          
 198          
 199          
 200          
 201          
 202          /*************************************************************************************************
 203          *                                     函数声明
 204          *************************************************************************************************/
 205          void Timer0Init(void);    //10微秒挡位检测
 206          void timer0_isr();
 207          
 208          void Timer1Init(void);    //1毫秒@12.000MHz   //按键
 209          void timer1_isr();
 210          
 211          void float_to_str(float num,int t_size, char *str, unsigned char a);    //浮点数转字符串
 212          void int_to_str(int num,int t_size, char *str, unsigned char a);//整型转字符串
 213          
 214          void water_buzzer();    //水位检测
 215          void dht22_oled();      //显示dht22
 216          void atomizing_choose();        //喷雾挡位选择
 217          
 218          
 219          void pwm(unsigned char cnt);      //选择挡位
 220          void Key_Loop(void);              //判断挡位
 221          unsigned char Key_GetState();     //按键获取  
 222          
 223          void OLED_ShowNumber(unsigned char x, y,int num,unsigned char str[],unsigned char len);
 224          void OLED_Showfloat(unsigned char x, y,unsigned char str[],float temp);
 225          /*************************************************************************************************
 226          *                                       主程序
 227          *************************************************************************************************/
 228          void main()
 229          {
 230   1        Initial_M096128x64_ssd1306();     //oled初始化
 231   1        OLED_Clear();                     //清屏
 232   1        /********************************************开机动画************************************************/
 233   1        //16*16大小的字体
 234   1          Xianshi_16X16(4,4,0);// 显示六
 235   1          Xianshi_16X16(21,4,1);//显示职
 236   1          Xianshi_16X16(38,4,2);//显示启
 237   1          Xianshi_16X16(54,4,3);//显示智
 238   1          Xianshi_16X16(71,4,4);//显示队
 239   1          Xianshi_8X16(46,6,"2023.10.22");
 240   1        /********************************************dht22初始化*************************************************
C51 COMPILER V9.59.0.0   MAIN                                                              10/16/2023 13:31:38 PAGE 5   

             -*******/  
 241   1        
 242   1        DHT22_init();
 243   1        //Read_Lcd();//读取温湿度
 244   1        Delay_50ms(20);
 245   1        
 246   1        OLED_Clear();           //清屏
 247   1        /******************************************定时器********************************************************
             -**/
 248   1        Timer1Init();
 249   1          
 250   1        while(1)
 251   1        { 
 252   2          water_buzzer();   //水位检测
 253   2          dht22_oled();     //dht22显示
 254   2          atomizing_choose();   //喷雾挡位开启
 255   2          delay(2000);
 256   2        }
 257   1      }
 258          
 259          void Timer1Init(void)   //1毫秒@12.000MHz
 260          {
 261   1        TMOD &= 0x0F;   //设置定时器模式
 262   1        TL1 = 0x20;   //设置定时初值
 263   1        TH1 = 0xD1;   //设置定时初值
 264   1        TF1 = 0;    //清除TF1标志
 265   1      
 266   1        ET1=1;
 267   1        EA=1;
 268   1        
 269   1        TR1 = 1;    //定时器1开始计时
 270   1      }
 271          
 272          
 273          void timer1_isr() interrupt 3 
 274          {
 275   1        Key_Loop();   //挡位按键扫描
 276   1        
 277   1        if(Key_L==0)                    //warring调节按键
 278   1        {
 279   2          if(key.debounce_count < 16)
 280   2          {
 281   3            key.debounce_count++;       //计数器
 282   3          }else
 283   2          {
 284   3            key.warring--;
 285   3            key.debounce_count-=16;
 286   3          }
 287   2        }
 288   1        if(Key_H==0)
 289   1        {   
 290   2          if(key.debounce_count2 < 16)
 291   2          {
 292   3            key.debounce_count2++;
 293   3          }else
 294   2          {
 295   3            key.warring++;
 296   3            key.debounce_count2-=16;
 297   3          }   
 298   2        }
 299   1      }
 300          void water_buzzer()       //检测水位
C51 COMPILER V9.59.0.0   MAIN                                                              10/16/2023 13:31:38 PAGE 6   

 301          {
 302   1        unsigned char i;
 303   1        if(Water_level==1)                        //水位检测,无水
 304   1        {
 305   2          atomizing.flag=0;
 306   2          pwm(3);         //停止挡位
 307   2          //声光报警
 308   2          led2=0;
 309   2          for(i=0;i<2;i++)    
 310   2          {                       
 311   3            buzzzer=0;
 312   3          }
 313   2        }else
 314   1        {
 315   2          if(humidity<key.warring)
 316   2          {
 317   3            atomizing.flag=1;     //喷雾标志位
 318   3          }else
 319   2          {
 320   3            atomizing.flag=0;
 321   3            pwm(3);         //停止挡位
 322   3          }
 323   2        }
 324   1        //结束声光报警
 325   1        if(Water_level==0)
 326   1        {
 327   2          led2=1;
 328   2          buzzzer=1;
 329   2        }
 330   1      }
 331          
 332          void dht22_oled()         //温湿度检测
 333          {
 334   1        Read_Lcd();//读取温湿度
 335   1        //显示湿度
 336   1        Xianshi_16X16(0,4,6);
 337   1        Xianshi_16X16(16,4,7);
 338   1        Xianshi_8X16(33,4,":");
 339   1        humidity=humidity+((long int)(humidity*10)%10)/10;        //显示小数点
 340   1        
 341   1        OLED_Showfloat(49,4,Invert.humidity2,humidity);             //显示变量
 342   1      
 343   1        
 344   1        //显示温度
 345   1        if(flag)
 346   1        {
 347   2          Xianshi_8X16(40,4,"-");
 348   2        }else
 349   1        {
 350   2          Xianshi_8X16(40,4," ");
 351   2        }
 352   1        Xianshi_16X16(0,6,5);// 显示温度
 353   1        Xianshi_16X16(16,6,7);//  显示
 354   1        Xianshi_8X16(33,6,":");   
 355   1        temperature=temperature+((long int)(temperature*10)%10)/10;       //显示小数点
 356   1        OLED_Showfloat(49,6,Invert.temperature2,temperature);             //显示变量
 357   1      
 358   1        //显示阈值
 359   1        if(key.warring<0)                                                 //判断温度正负
 360   1        {
 361   2          Xianshi_8X16(81,3,"-");
 362   2        }else
C51 COMPILER V9.59.0.0   MAIN                                                              10/16/2023 13:31:38 PAGE 7   

 363   1        {
 364   2          Xianshi_8X16(81,3," ");
 365   2        }
 366   1        Xianshi_16X16(60,0,8);//  显示预设温度
 367   1        Xianshi_16X16(77,0,9);//  显示
 368   1        Xianshi_16X16(94,0,6);//  显示
 369   1        Xianshi_16X16(111,0,7);// 显示
 370   1        OLED_ShowNumber(87,2,key.warring,Invert.warring2,3);
*** WARNING C182 IN LINE 370 OF main.c: pointer to different objects
 371   1        
 372   1        
 373   1        
 374   1        Xianshi_16X16(0,0,10);//  显示挡位
 375   1        Xianshi_16X16(16,0,11);// 显示
 376   1        OLED_ShowNumber(4,2,atomizing.count,Invert.count2,2);
*** WARNING C182 IN LINE 376 OF main.c: pointer to different objects
 377   1            
 378   1       }
 379          void atomizing_choose()       //喷雾挡位选择
 380          { 
 381   1        if(atomizing.flag==1)
 382   1        {
 383   2          pwm(atomizing.count);
 384   2        }
 385   1      }
 386          
 387          unsigned char Key_GetState()    //按键判断
 388          {
 389   1        unsigned char KeyNumber=0;
 390   1        
 391   1        if(key_ctrl==0){KeyNumber=1;}
 392   1      
 393   1        return KeyNumber;
 394   1      }
 395          
 396          void Key_Loop(void)       //按键扫描
 397          {
 398   1        static unsigned char NowState,LastState;
 399   1        LastState=NowState;       //按键状态更新
 400   1        NowState=Key_GetState();    //获取当前按键状态
 401   1        //如果上个时间点按键按下，这个时间点未按下，则是松手瞬间，以此避免消抖和松手检测
 402   1        if(LastState==1 && NowState==0)
 403   1        {
 404   2          atomizing.count++;
 405   2        }
 406   1        if(atomizing.count>=4)
 407   1        {
 408   2          atomizing.count=1;
 409   2        }
 410   1      }
 411          
 412          void pwm(unsigned char cnt)   //挡位选择
 413          {
 414   1        switch(cnt)
 415   1        {
 416   2          case 1: led=0;
 417   2                  pwm1=0;       //1档
 418   2                  pwm2=1;
 419   2                  break;
 420   2          
 421   2          case 2: led=0;
 422   2                  pwm1=0;       //2档
C51 COMPILER V9.59.0.0   MAIN                                                              10/16/2023 13:31:38 PAGE 8   

 423   2                  pwm2=0;
 424   2                  break;
 425   2              
 426   2          case 3: led=1;
 427   2                  pwm1=1;       //停止
 428   2                  pwm2=1;
 429   2                  break;
 430   2        }
 431   1      }
 432          
 433          
 434          void OLED_ShowNumber(unsigned char x, y,int num,unsigned char str[],unsigned char len)        //显示数字
 435          {  
 436   1          sprintf(str, "%d", num); // 将数字转换为字符串
 437   1          str[len-1]='\0';
 438   1          Xianshi_8X16(x, y, str); // 显示数字  
 439   1      }  
 440          
 441          
 442          void OLED_Showfloat(unsigned char x, y,unsigned char str[],float temp)                        //显示字符串
 443          {  
 444   1        sprintf(str, "%.1f", temp); // 将浮点数转换为字符串
 445   1        str[2]='.';
 446   1        if(str[3]=='.')                                                                               
 447   1        {
 448   2          str[3]=str[1];
 449   2        }
 450   1        str[4]='\0';
 451   1        Xianshi_8X16(x, y, str); // 显示字符串
 452   1        
 453   1      }  
 454          
 455          
 456          
 457          
 458          
 459          
 460          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1276    ----
   CONSTANT SIZE    =   1929    ----
   XDATA SIZE       =     32      19
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  2 WARNING(S),  0 ERROR(S)
