C51 COMPILER V9.59.0.0   DHT22                                                             10/16/2023 13:31:38 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE DHT22
OBJECT MODULE PLACED IN .\Objects\dht22.obj
COMPILER INVOKED BY: D:\Keil_C51\C51\BIN\C51.EXE dht22.c LARGE OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listi
                    -ngs\dht22.lst) TABS(2) OBJECT(.\Objects\dht22.obj)

line level    source

   1          #include <STC89C5xRC.H>
   2            
   3          sbit DA=P2^3;  
   4          
   5          float humidity=0.0;
   6          float temperature=0.0;
   7          unsigned char flag=0;
   8          //float old_humidity=0.0;
   9          //float old_temperature=0.0;
  10            
  11          void delay(unsigned int x_ms)         
  12          {  
  13   1          unsigned char i, j;  
  14   1        while(x_ms)  
  15   1          {   i = 2;  
  16   2          j = 239;  
  17   2          do  
  18   2          {  
  19   3              while (--j);  
  20   3          } while (--i);  
  21   2            x_ms--;  
  22   2          }  
  23   1      }  
  24            
  25          unsigned char  DHT22_init()  
  26          {  
  27   1          unsigned char i;  
  28   1          DA=1;  
  29   1          DA=0;  
  30   1          delay(20);                              //delay 1ms  
  31   1          DA=1;  
  32   1          while(DA==1);  
  33   1          i = 27;while (--i);     //delay 60us  
  34   1          if(DA==1) return 1;  
  35   1          i = 37;while (--i);         //delay 80us  
  36   1          if(DA==0) return 1;  
  37   1          while(DA==1); 
  38   1      
  39   1          return 0;
  40   1      }  
  41            
  42          unsigned char ReadHH()      //读湿度高八位  
  43          {  
  44   1          unsigned char i,n,HH=0x00;  
  45   1          for(n=0;n<8;n++)  
  46   1          {  
  47   2              while(DA==0);  
  48   2                
  49   2              while (DA==1)  
  50   2              {  
  51   3                  i = 17;while (--i); //delau 40us  
  52   3                  if(DA==1)  
  53   3                  HH=HH|(0X01<<(7-n));  
  54   3              }  
C51 COMPILER V9.59.0.0   DHT22                                                             10/16/2023 13:31:38 PAGE 2   

  55   2          }     
  56   1          return HH;  
  57   1      }  
  58                
  59          unsigned char ReadHL()          //读湿度低八位  
  60          {  
  61   1          unsigned char i,n,HL=0x00;  
  62   1          for(n=0;n<8;n++)  
  63   1          {  
  64   2              while(DA==0);  
  65   2                
  66   2              while (DA==1)  
  67   2              {  
  68   3                  i = 17;while (--i); //delau 40us  
  69   3                  if(DA==1)  
  70   3                  HL=HL|(0X01<<(7-n));  
  71   3              }  
  72   2          }     
  73   1          return HL;    
  74   1      }  
  75            
  76          unsigned char ReadTH()              //读温度高八位  
  77          {  
  78   1          unsigned char i,n,TH=0x00;  
  79   1          for(n=0;n<8;n++)  
  80   1          {  
  81   2              while(DA==0);  
  82   2                
  83   2              while (DA==1)  
  84   2              {  
  85   3                  i = 17;while (--i); //delau 40us  
  86   3                  if(DA==1)  
  87   3                  TH=TH|(0X01<<(7-n));  
  88   3              }  
  89   2          }     
  90   1          return TH;    
  91   1      }  
  92            
  93          unsigned char ReadTL()          //读温度低八位  
  94          {  
  95   1          unsigned char i,n,TL=0x00;  
  96   1          for(n=0;n<8;n++)  
  97   1          {  
  98   2              while(DA==0);  
  99   2                
 100   2              while (DA==1)  
 101   2              {  
 102   3                  i = 17;while (--i); //delau 40us  
 103   3                  if(DA==1)  
 104   3                  TL=TL|(0X01<<(7-n));  
 105   3              }  
 106   2          }     
 107   1          return TL;  
 108   1      }
 109          
 110          unsigned char Read_Lcd()
 111          {
 112   1        unsigned char TH;                   //温度高8位
 113   1        unsigned char TL;                   //温度低8位
 114   1        unsigned char RH_H;                 //湿度高8位
 115   1        unsigned char RH_L;                 //湿度低8位
 116   1        
C51 COMPILER V9.59.0.0   DHT22                                                             10/16/2023 13:31:38 PAGE 3   

 117   1        DHT22_init();                       //初始化
 118   1      //  old_humidity=humidity;
 119   1      //  old_temperature=temperature;
 120   1        
 121   1        RH_H=ReadHH();      //读湿度高八位
 122   1        RH_L=ReadHL();      //读湿度高八位
 123   1        TH=ReadTH();      //读温度高八位
 124   1        TL=ReadTL();      //读温度高八位
 125   1        
 126   1        
 127   1        if(TH & 0x80)                       //温度高位判断正负同时置0
 128   1        {
 129   2            flag = 1;
 130   2            TH &= 0x7F;
 131   2        }else
 132   1        {
 133   2          flag=0;
 134   2        } 
 135   1        humidity=RH_H<<8|RH_L;                //合并16位二进制
 136   1        temperature=TH<<8|TL;
 137   1        
 138   1        humidity/=10;                         //转化10进制
 139   1        temperature/=10;
 140   1        
 141   1        
 142   1        
 143   1      //  if((humidity<=25))
 144   1      //  {
 145   1      //    humidity=old_humidity;
 146   1      //  }
 147   1      //  if(temperature>=80)
 148   1      //  {
 149   1      //    temperature=old_temperature;
 150   1      //  }
 151   1        
 152   1      }
*** WARNING C173 IN LINE 152 OF dht22.c: missing return-expression
 153          
 154          
*** WARNING C290 IN LINE 152 OF dht22.c: missing return value


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    407    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      9       2
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  2 WARNING(S),  0 ERROR(S)
