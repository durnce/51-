C51 COMPILER V9.59.0.0   OLED                                                              10/16/2023 13:31:38 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE OLED
OBJECT MODULE PLACED IN .\Objects\oled.obj
COMPILER INVOKED BY: D:\Keil_C51\C51\BIN\C51.EXE oled.c LARGE OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listin
                    -gs\oled.lst) TABS(2) OBJECT(.\Objects\oled.obj)

line level    source

   1          #include "oled.h"
   2          #include "picture.h"  
   3          
   4          
   5          
   6          /**********************************************
   7          //IIC Start
   8          **********************************************/
   9          void IIC_Start()
  10          {
  11   1         SCL = high;    
  12   1         SDA = high;
  13   1         SDA = low;
  14   1         SCL = low;
  15   1      }
  16          
  17          /**********************************************
  18          //IIC Stop
  19          **********************************************/
  20          void IIC_Stop()
  21          {
  22   1         SCL = low;
  23   1         SDA = low;
  24   1         SCL = high;
  25   1         SDA = high;
  26   1      }
  27          /**********************************************
  28          // IIC Write byte
  29          **********************************************/
  30          void Write_IIC_Byte(unsigned char IIC_Byte)
  31          {
  32   1        unsigned char i;
  33   1        for(i=0;i<8;i++)    
  34   1        {
  35   2          if(IIC_Byte & 0x80)
  36   2          SDA=high;
  37   2          else
  38   2          SDA=low;
  39   2          SCL=high;
  40   2          SCL=low;
  41   2          IIC_Byte<<=1;
  42   2        }
  43   1        SDA=1;
  44   1        SCL=1;
  45   1        SCL=0;
  46   1      }
  47          /**********************************************
  48          // IIC Write Command
  49          **********************************************/
  50          void Write_IIC_Command(unsigned char IIC_Command)
  51          {
  52   1         IIC_Start();
  53   1         Write_IIC_Byte(0x78);            //Slave address,SA0=0
  54   1         Write_IIC_Byte(0x00);      //write command
C51 COMPILER V9.59.0.0   OLED                                                              10/16/2023 13:31:38 PAGE 2   

  55   1         Write_IIC_Byte(IIC_Command); 
  56   1         IIC_Stop();
  57   1      }
  58          /**********************************************
  59          // IIC Write Data
  60          **********************************************/
  61          void Write_IIC_Data(unsigned char IIC_Data)
  62          {
  63   1         IIC_Start();
  64   1         Write_IIC_Byte(0x78);      //D/C#=0; R/W#=0
  65   1         Write_IIC_Byte(0x40);      //write data
  66   1         Write_IIC_Byte(IIC_Data);
  67   1         IIC_Stop();
  68   1      }
  69          /********************************************
  70          // fill_Picture
  71          ********************************************/
  72          void fill_picture(unsigned char fill_Data)
  73          {
  74   1        unsigned char m,n;
  75   1        for(m=0;m<8;m++)
  76   1        {
  77   2          Write_IIC_Command(0xb0+m);    //page0-page1
  78   2          Write_IIC_Command(0x00);    //low column start address
  79   2          Write_IIC_Command(0x10);    //high column start address
  80   2          for(n=0;n<132;n++)
  81   2            {
  82   3              Write_IIC_Data(fill_Data);
  83   3            }
  84   2        }
  85   1      }
  86          ///******************************************
  87          //// pictureÊòæÁ§∫‰∏ÄÂº†ÂõæÁâá
  88          //******************************************/
  89          //void Picture()
  90          //{
  91          //  unsigned char x,y;
  92          //  unsigned int i=0;
  93          //  for(y=0;y<8;y++)
  94          //    {
  95          //      Write_IIC_Command(0xb0+y);
  96          //      Write_IIC_Command(0x0);
  97          //      Write_IIC_Command(0x10);
  98          //      for(x=0;x<132;x++)
  99          //        {
 100          //          Write_IIC_Data(BMP[i++]);
 101          //        }
 102          //    }
 103          //}
 104          
 105          /***********************Delay****************************************/
 106          void Delay_50ms(unsigned int Del_50ms)
 107          {
 108   1        unsigned int m;
 109   1        for(;Del_50ms>0;Del_50ms--)
 110   1          for(m=6245;m>0;m--);
 111   1      }
 112          
 113          void Delay_1ms(unsigned int Del_1ms)
 114          {
 115   1        unsigned char j;
 116   1        while(Del_1ms--)
C51 COMPILER V9.59.0.0   OLED                                                              10/16/2023 13:31:38 PAGE 3   

 117   1        { 
 118   2          for(j=0;j<123;j++);
 119   2        }
 120   1      }
 121          
 122          
 123          
 124          //ÂùêÊ†áËÆæÁΩÆ
 125          void Set_add(unsigned char x, unsigned char y) //xË°®Á§∫ÂàóÔºà0~127ÔºâÔºåyË°®Á§∫È°µÔºà0~7Ôºâ
 126          {   
 127   1        Write_IIC_Command(0xb0+y);                        //ËÆæÁΩÆÈ°µÂú∞ÂùÄÔºà0~7Ôºâ
 128   1        Write_IIC_Command(((x&0xf0)>>4)|0x10);             //ËÆæÁΩÆÊòæÁ§∫‰ΩçÁΩÆ‚ÄîÂàóÈ´òÂú∞ÂùÄ
 129   1        Write_IIC_Command((x&0x0f));                        //ËÆæÁΩÆÊòæÁ§∫‰ΩçÁΩÆ‚ÄîÂàó‰ΩéÂú∞ÂùÄ
 130   1      }   
 131          
 132          void Initial_M096128x64_ssd1306()
 133          {
 134   1        Delay_1ms(5);
 135   1        Write_IIC_Command(0xAE);   //display off
 136   1        Write_IIC_Command(0x20);  //Set Memory Addressing Mode  
 137   1        Write_IIC_Command(0x10);  //00,Horizontal Addressing Mode;01,Vertical Addressing Mode;10,Page Addressing M
             -ode (RESET);11,Invalid
 138   1        Write_IIC_Command(0xb0);  //Set Page Start Address for Page Addressing Mode,0-7
 139   1        Write_IIC_Command(0xc8);  //Set COM Output Scan Direction
 140   1        Write_IIC_Command(0x00);//---set low column address
 141   1        Write_IIC_Command(0x10);//---set high column address
 142   1        Write_IIC_Command(0x40);//--set start line address
 143   1        Write_IIC_Command(0x81);//--set contrast control register
 144   1        Write_IIC_Command(0xdf);
 145   1        Write_IIC_Command(0xa1);//--set segment re-map 0 to 127
 146   1        Write_IIC_Command(0xa6);//--set normal display
 147   1        Write_IIC_Command(0xa8);//--set multiplex ratio(1 to 64)
 148   1        Write_IIC_Command(0x3F);//
 149   1        Write_IIC_Command(0xa4);//0xa4,Output follows RAM content;0xa5,Output ignores RAM content
 150   1        Write_IIC_Command(0xd3);//-set display offset
 151   1        Write_IIC_Command(0x00);//-not offset
 152   1        Write_IIC_Command(0xd5);//--set display clock divide ratio/oscillator frequency
 153   1        Write_IIC_Command(0xf0);//--set divide ratio
 154   1        Write_IIC_Command(0xd9);//--set pre-charge period
 155   1        Write_IIC_Command(0x22); //
 156   1        Write_IIC_Command(0xda);//--set com pins hardware configuration
 157   1        Write_IIC_Command(0x12);
 158   1        Write_IIC_Command(0xdb);//--set vcomh
 159   1        Write_IIC_Command(0x20);//0x20,0.77xVcc
 160   1        Write_IIC_Command(0x8d);//--set DC-DC enable
 161   1        Write_IIC_Command(0x14);//
 162   1        Write_IIC_Command(0xaf);//--turn on oled panel 
 163   1      }
 164          
 165          
 166          //Ê∏ÖÂ±èÂáΩÊï∞,Ê∏ÖÂÆåÂ±è,Êï¥‰∏™Â±èÂπïÊòØÈªëËâ≤ÁöÑ!ÂíåÊ≤°ÁÇπ‰∫Æ‰∏ÄÊ†∑!!!
 167          //ÂÖàÈÄâ‰∏≠È°µÔºåÂàùÂßã‰ΩçÁΩÆÔºåÁÑ∂Âêé128ÂàóÂÖ®ÈÉ®Ê∏ÖÈõ∂
 168          void OLED_Clear(void)  
 169          {  
 170   1        unsigned char i,n;        
 171   1        for(i=0;i<8;i++)  
 172   1        {  
 173   2          Write_IIC_Command (0xb0+i); //ÈÄâ‰∏≠È°µÂú∞ÂùÄÔºà0~7Ôºâ
 174   2          Write_IIC_Command (0x00);   //ÈÄâ‰∏≠ÊòæÁ§∫‰ΩçÁΩÆ‚ÄîÂàó‰ΩéÂú∞ÂùÄ
 175   2          Write_IIC_Command (0x10);   //ÈÄâ‰∏≠ÊòæÁ§∫‰ΩçÁΩÆ‚ÄîÂàóÈ´òÂú∞ÂùÄ   
 176   2          for(n=0;n<128;n++)  //ÈÄâ‰∏≠ÊâÄÊúâÂÉèÁ¥†ÁÇπ
 177   2              Write_IIC_Data(0);   //ÂÖ≥Èó≠ÂÉèÁ¥†ÁÇπ
C51 COMPILER V9.59.0.0   OLED                                                              10/16/2023 13:31:38 PAGE 4   

 178   2        } //Êõ¥Êñ∞ÊòæÁ§∫
 179   1      }
 180           
 181           
 182          //ÂõæÁâáÊòæÁ§∫ÂáΩÊï∞ÔºåÊòæÁ§∫BMPÂõæÁâá128√ó64Ëµ∑ÂßãÁÇπÂùêÊ†á
 183           
 184          /*  x0„ÄÅx1:ÊòæÁ§∫Êï∞ÊçÆÁöÑÂàó‰ΩçÁΩÆÔºõ
 185                x0ÔºöÊï∞ÊçÆÁöÑÂàùÂßã‰ΩçÁΩÆ          ÂàöÂºÄÂßãÂú®Âì™‰∏ÄÂàóÊâìÂç∞Âá∫Êù•
 186                x1ÔºöÊï∞ÊçÆÁöÑÊúÄÂêéÁöÑ‰ΩçÁΩÆ        Âú®Âì™‰∏ÄÂàóÊâìÂç∞ÁªìÊùü
 187              y0„ÄÅy1ÔºöÊòæÁ§∫ÁöÑÈ°µ‰ΩçÁΩÆ
 188                y0ÔºöÊï∞ÊçÆÁöÑÂàùÂßãÈ°µ‰ΩçÁΩÆÔºàË°åÔºâÔºõÂàöÂºÄÂßãÂú®Âì™‰∏ÄË°åÊâìÂç∞Âá∫Êù•
 189                y1:Êï∞ÊçÆÁöÑÊúÄÂêéÁöÑ‰ΩçÁΩÆÔºàË°åÔºâ   Âú®Âì™‰∏ÄË°åÊâìÂç∞ÁªìÊùü
 190           
 191              BMP[]:ÈúÄË¶ÅÊâìÂç∞ÁöÑÊï∞ÊçÆ
 192          */
 193          void Xianshi_Tupian(unsigned char x0, unsigned char y0,unsigned char x1, unsigned char y1,unsigned char BM
             -P[])
 194          {   
 195   1       unsigned int j=0;
 196   1       unsigned char x,y;
 197   1        
 198   1        if(y1%8==0) 
 199   1          y=y1/8;      
 200   1        else 
 201   1          y=y1/8+1;
 202   1        for(y=y0;y<y1;y++)
 203   1        {
 204   2            Set_add(x0,y);
 205   2            for(x=x0;x<x1;x++)
 206   2            {      
 207   3                Write_IIC_Data(BMP[j++]);       
 208   3            }
 209   2        }
 210   1      }
 211           
 212          //16x16ÊòæÁ§∫ÂáΩÊï∞
 213          /***ÂäüËÉΩÊèèËø∞ÔºöÊòæÁ§∫16*16ÁÇπÈòµ  ÊòæÁ§∫ÁöÑÂùêÊ†áÔºàx,yÔºâÔºåy‰∏∫È°µËåÉÂõ¥0ÔΩû7***********************
             -*****/
 214          void Xianshi_16X16(unsigned char x, y, N)
 215          {
 216   1        unsigned char wm=0;
 217   1        unsigned int adder=32*N;
 218   1        Set_add(x , y);
 219   1        for(wm = 0;wm < 16;wm++)
 220   1        {
 221   2          Write_IIC_Data(F16x16[adder]);
 222   2          adder += 1;
 223   2        }
 224   1        
 225   1        Set_add(x,y + 1);
 226   1        for(wm = 0;wm < 16;wm++)
 227   1        {
 228   2          Write_IIC_Data(F16x16[adder]);
 229   2          adder += 1;
 230   2        }       
 231   1      }
 232          
 233          
 234          /* 8X16ÊòæÁ§∫ */
 235          //ÂèØ‰ª•Ëá™Â∑±ÊâæÂá∫Êù•Êï∞ÊçÆÂØπÂ∫îÁöÑÊï∞ÁªÑ
 236          /*******************ÂäüËÉΩÊèèËø∞ÔºöÊòæÁ§∫8*16‰∏ÄÁªÑÊ†áÂáÜASCIIÂ≠óÁ¨¶‰∏≤  ÊòæÁ§∫ÁöÑÂùêÊ†áÔºàx,yÔºâÔºåy‰∏∫È°
             -µËåÉÂõ¥0ÔΩû7****************/
C51 COMPILER V9.59.0.0   OLED                                                              10/16/2023 13:31:38 PAGE 5   

 237          //ch[]:ÊÉ≥Ë¶ÅËæìÂÖ•ÁöÑÊï∞ÊçÆÔºå‰ºöËá™Âä®Âú®F8X16[]‰∏≠ÂØªÊâæÂá∫Êù•Âπ∂ÂèëÈÄÅÁªôOLED
 238          void Xianshi_8X16(unsigned char x, y,unsigned char ch[])
 239          {
 240   1        unsigned char c=0,i=0,j=0;
 241   1        while (ch[j]!='\0')
 242   1        {
 243   2          c =ch[j]-32;
 244   2          if(x>120){x=0;y++;}
 245   2          
 246   2          Set_add(x,y);     //‰∏ÄÂÖ±‰∏§È°µÔºåÁ¨¨‰∏ÄÈ°µ
 247   2          for(i=0;i<8;i++)
 248   2          Write_IIC_Data(F8X16[c*16+i]);
 249   2           
 250   2          Set_add(x,y+1);   //‰∏ÄÂÖ±‰∏§È°µÔºåÁ¨¨‰∫åÈ°µ
 251   2          for(i=0;i<8;i++)     
 252   2          Write_IIC_Data(F8X16[c*16+i+8]);
 253   2          
 254   2          x+=8;
 255   2          j++;
 256   2        }
 257   1      }
 258          
 259          
 260          
 261          
 262          
 263          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    867    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----      20
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
